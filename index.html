<script>
// ===== EXISTING CODE ABOVE (ship, shots, enemies, explosions) =====

// Boss
let boss = null;
let bossShots = [];

function spawnBoss(){
  boss = {
    x: W/2, y: 80, w: 140, h: 60,
    vx: 2, hp: 40, maxHp: 40, alive: true
  };
  bossShots.length = 0;
}

function updateBoss(){
  if(!boss || !boss.alive) return;

  // Movement side to side
  boss.x += boss.vx;
  if(boss.x < boss.w/2 || boss.x > W-boss.w/2) boss.vx *= -1;

  // Shoot occasionally
  if(Math.random() < 0.02){
    bossShots.push({ x: boss.x, y: boss.y+boss.h/2, vy: 4 });
  }

  // Boss shots move
  for(let i=bossShots.length-1;i>=0;i--){
    bossShots[i].y += bossShots[i].vy;
    if(bossShots[i].y>H) bossShots.splice(i,1);
  }

  // Collisions: bullets vs boss
  for(let j=shots.length-1;j>=0;j--){
    if(Math.abs(shots[j].x-boss.x) < boss.w/2 &&
       Math.abs(shots[j].y-boss.y) < boss.h/2){
      shots.splice(j,1);
      boss.hp--;
      spawnExplosion(boss.x+(Math.random()*40-20), boss.y);
      if(boss.hp<=0){
        boss.alive=false;
        score+=500;
        spawnExplosion(boss.x,boss.y);
      }
    }
  }

  // Collisions: boss shots vs ship
  for(let i=bossShots.length-1;i>=0;i--){
    if(Math.abs(bossShots[i].x-ship.x) < ship.w &&
       Math.abs(bossShots[i].y-ship.y) < ship.h){
      bossShots.splice(i,1);
      spawnExplosion(ship.x,ship.y);
      lives--;
      if(lives<=0) gameOver();
    }
  }

  // Collision: ship vs boss (ramming)
  if(Math.abs(ship.x-boss.x)<(ship.w/2+boss.w/2) &&
     Math.abs(ship.y-boss.y)<(ship.h/2+boss.h/2)){
    spawnExplosion(ship.x,ship.y);
    lives=0; gameOver();
  }
}

function drawBoss(){
  if(!boss || !boss.alive) return;
  ctx.save();
  ctx.fillStyle='#ff0077';
  ctx.shadowBlur=30; ctx.shadowColor='#ff0077';
  ctx.fillRect(boss.x-boss.w/2, boss.y-boss.h/2, boss.w, boss.h);
  ctx.restore();

  // Boss HP bar
  ctx.save();
  ctx.fillStyle='#111'; ctx.fillRect(W/2-100,20,200,12);
  ctx.fillStyle='#ff0077'; 
  ctx.fillRect(W/2-100,20,(boss.hp/boss.maxHp)*200,12);
  ctx.strokeStyle='#fff'; ctx.strokeRect(W/2-100,20,200,12);
  ctx.restore();

  // Boss shots
  ctx.save();
  ctx.fillStyle='#f00'; ctx.shadowBlur=12; ctx.shadowColor='#f55';
  bossShots.forEach(b=>ctx.fillRect(b.x-3,b.y-8,6,16));
  ctx.restore();
}

// ===== MODIFY update() to trigger boss =====
function update(){
  // ... existing update code for ship, shots, enemies, explosions ...

  // Boss spawns every 1000 score
  if(!boss && score>0 && Math.floor(score)%1000===0){
    spawnBoss();
  }
  if(boss) updateBoss();
}

// ===== MODIFY loop() to draw boss =====
function loop(){
  if(!running||paused) return;
  update();
  ctx.clearRect(0,0,W,H);
  drawGrid(); drawShip(); drawShots(); drawEnemies(); drawExplosions(); drawHUD();
  drawBoss(); // <== added
  requestAnimationFrame(loop);
}
</script>
